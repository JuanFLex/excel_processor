.min-h-screen.bg-white
  .max-w-4xl.mx-auto.px-4.sm:px-6.lg:px-8.py-8.lg:py-12
    / Header with navigation
    .mb-12
      = link_to "‚Üê Back to References", commodity_references_path(search: params[:search]), class: "text-sm text-gray-600 hover:text-gray-900 mb-6 inline-block"
      %h1.text-2xl.font-medium.text-gray-900.mb-2 Edit Commodity Reference
      %p.text-sm.text-gray-600 Update keywords and manufacturer information

    / Reference Info (Read-only)
    .bg-gray-50.p-6.rounded-lg.mb-8
      .grid.grid-cols-1.md:grid-cols-2.gap-4
        .div
          %label.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Level 1
          %p.text-sm.text-gray-900.mt-1= @commodity.level1_desc
        .div
          %label.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Level 2  
          %p.text-sm.text-gray-900.mt-1= @commodity.level2_desc
        .div
          %label.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Level 3
          %p.text-sm.text-gray-900.mt-1= @commodity.level3_desc
        .div
          %label.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Level 3 Expanded
          %p.text-sm.text-gray-900.mt-1= @commodity.level3_desc_expanded.present? ? @commodity.level3_desc_expanded : '-'
        .div
          %label.text-xs.font-medium.text-gray-500.uppercase.tracking-wider MPN by Manufacturer
          %p.text-sm.text-gray-900.mt-1= @commodity.typical_mpn_by_manufacturer.present? ? @commodity.typical_mpn_by_manufacturer : '-'
        .div
          %label.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Current Scope Status
          %span.inline-flex.px-2.py-1.text-xs.font-medium.rounded.mt-1{class: @commodity.infinex_scope_status == 'In Scope' ? 'text-green-700 bg-green-100' : 'text-red-700 bg-red-100'}
            = @commodity.infinex_scope_status
        .div
          %label.text-xs.font-medium.text-gray-500.uppercase.tracking-wider Auto Scope Status
          - if @commodity.autograde_scope.present?
            %span.inline-flex.px-2.py-1.text-xs.font-medium.rounded.mt-1{class: @commodity.autograde_scope == 'In Scope' ? 'text-blue-700 bg-blue-100' : 'text-orange-700 bg-orange-100'}
              = @commodity.autograde_scope
          - else
            %p.text-sm.text-gray-400.mt-1 Not set

    / Edit Form
    .bg-white.border.border-gray-200.rounded-lg.p-6
      = form_with model: @commodity, url: commodity_reference_path(@commodity), local: true do |f|
        / Hidden field to preserve search
        = hidden_field_tag :search, params[:search]
        
        .space-y-6
          .div
            = f.label :infinex_scope_status, "Scope Status", class: "block text-sm font-medium text-gray-700 mb-2"
            = f.select :infinex_scope_status, 
              options_for_select(CommodityReference::SCOPE_OPTIONS.map { |option| [option, option] }, @commodity.infinex_scope_status),
              { prompt: "Select scope status..." },
              { class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-gray-500 focus:border-gray-500" }
            - if @commodity.errors[:infinex_scope_status].any?
              %p.text-red-600.text-sm.mt-1= @commodity.errors[:infinex_scope_status].first

          .div
            = f.label :autograde_scope, "Auto Scope Status", class: "block text-sm font-medium text-gray-700 mb-2"
            = f.select :autograde_scope,
              options_for_select([['In Scope', 'In Scope'], ['Out of Scope', 'Out of Scope']], @commodity.autograde_scope),
              { prompt: "Select auto scope status..." },
              { class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-gray-500 focus:border-gray-500" }
            %p.text-xs.text-gray-500.mt-1 Used when Auto Mode is enabled for scope determination
            - if @commodity.errors[:autograde_scope].any?
              %p.text-red-600.text-sm.mt-1= @commodity.errors[:autograde_scope].first

          .div
            = f.label :keyword, class: "block text-sm font-medium text-gray-700 mb-2"
            = f.text_field :keyword, 
              class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-gray-500 focus:border-gray-500",
              placeholder: "Enter keywords for better matching..."
            - if @commodity.errors[:keyword].any?
              %p.text-red-600.text-sm.mt-1= @commodity.errors[:keyword].first

          .div
            = f.label :mfr, "Manufacturer", class: "block text-sm font-medium text-gray-700 mb-2"
            = f.text_field :mfr,
              class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-gray-500 focus:border-gray-500", 
              placeholder: "Enter manufacturer name..."
            - if @commodity.errors[:mfr].any?
              %p.text-red-600.text-sm.mt-1= @commodity.errors[:mfr].first

          .div
            = f.label :level3_desc_expanded, "Level 3 Description (Expanded)", class: "block text-sm font-medium text-gray-700 mb-2"
            = f.text_area :level3_desc_expanded,
              class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-gray-500 focus:border-gray-500", 
              placeholder: "Enter expanded description without abbreviations...",
              rows: 3
            - if @commodity.errors[:level3_desc_expanded].any?
              %p.text-red-600.text-sm.mt-1= @commodity.errors[:level3_desc_expanded].first

          .div
            = f.label :typical_mpn_by_manufacturer, "MPN by Manufacturer", class: "block text-sm font-medium text-gray-700 mb-2"
            = f.text_area :typical_mpn_by_manufacturer,
              class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-gray-500 focus:border-gray-500", 
              placeholder: "Enter representative MPNs by manufacturer (e.g., TI: LM358, ADI: AD620...)...",
              rows: 3
            - if @commodity.errors[:typical_mpn_by_manufacturer].any?
              %p.text-red-600.text-sm.mt-1= @commodity.errors[:typical_mpn_by_manufacturer].first

        / Actions
        .flex.gap-3.pt-6.border-t.border-gray-200
          = f.submit "Update Reference", class: "px-5 py-2.5 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-md transition-colors"
          = link_to "Cancel", commodity_references_path(search: params[:search]), class: "px-5 py-2.5 border border-gray-300 hover:border-gray-400 text-gray-700 hover:text-gray-900 text-sm font-medium rounded-md transition-colors"

:css
  body { -webkit-font-smoothing: antialiased; }